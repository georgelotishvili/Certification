<!doctype html>
<html lang="ka">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ადმინისტრატორის პანელი - Certification</title>
    <meta name="api-base" content="http://127.0.0.1:8000" />
    <script src="../scripts/config.js" defer></script>
    <script src="../scripts/admin/shared.js" defer></script>
    <script src="../scripts/admin/exam-settings.js" defer></script>
    <script src="../scripts/admin/blocks.js" defer></script>
    <script src="../scripts/admin/statements.js" defer></script>
    <script src="../scripts/admin/results.js" defer></script>
    <script src="../scripts/admin/certificate.js" defer></script>
    <script src="../scripts/admin/users.js" defer></script>
    <link rel="stylesheet" href="../styles/admin.css" />
  </head>
  <body>
    <header>

        
      <div class="auth-banner">ადმინისტრატორის გვერდი</div>

      <button class="login-btn">მთავარი გვერდი</button>

      <!-- Burger toggle for <=1050px (JS-driven) -->
      <button class="burger" aria-controls="mobile-drawer" aria-label="მენიუს გახსნა" aria-expanded="false" type="button">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="overlay" aria-hidden="true"></div>
      <aside id="mobile-drawer" class="drawer" aria-label="მობილური მენიუ">
        <button class="drawer-close" aria-label="დახურვა" type="button"></button>
        <div class="drawer-auth-banner">ადმინისტრატორის გვერდი</div>
        <nav class="drawer-nav">
          <a href="#">რეგისტრირებული პირები</a>
          <a href="#">გამოცდა</a>
          <a href="#">პროექტი</a>
        </nav>
        <button class="drawer-login">მთავარი გვერდი</button>
      </aside>

    </header>
    <div class="nav-bar">
      <nav class="nav">
        <a href="#">რეგისტრაციები</a>
        <a href="#">გამოცდა</a>
        <a href="#">პროექტი</a>
      </nav>
    </div>

    <main>
      <section id="exam-settings" class="exam-settings" style="display:none;">
        <div class="exam-topbar">
          <div class="duration-group">
            <label for="examDuration" class="duration-label">ხანგრძლივობა (წუთი)</label>
            <input id="examDuration" class="duration-input" type="number" min="1" max="300" value="60" />
            <button id="saveExamDuration" class="duration-save">შენახვა</button>
          </div>
          <div id="durationFlash" class="duration-flash" aria-live="polite" style="display:none;"></div>
          <div class="duration-group">
            <label for="adminGatePassword" class="duration-label">ადმინისტრატორის პაროლი</label>
            <input id="adminGatePassword" class="duration-input" type="text" placeholder="მაგ: cpig" />
            <button id="saveAdminGatePassword" class="duration-save">შენახვა</button>
          </div>
          <div id="gatePwdFlash" class="duration-flash" aria-live="polite" style="display:none;"></div>
        </div>

        <div class="exam-content">
          <div class="exam-blocks-header" aria-label="საგამოცდო ბლოკები">
            <h2 class="exam-blocks-title">საგამოცდო ბლოკები</h2>
            <div class="exam-blocks-stats">
              <span class="stat stat-blocks"><span class="label">ბლოკი</span> <span id="adminBlocksCount">0</span></span>
              <span class="stat stat-questions"><span class="label">კითხვა</span> <span id="adminQuestionsCount">0</span></span>
            </div>
            <input id="examBlocksSearch" class="exam-blocks-search" type="search" placeholder="ძებნა..." aria-label="საგამოცდო ბლოკების ძებნა" />
          </div>

          <div class="exam-blocks-grid">
            <button id="addBlockTile" class="block-tile add-tile" type="button" aria-label="ბლოკის დამატება">
              <span class="add-icon" aria-hidden="true">+</span>
              <span class="add-text">ბლოკის დამატება</span>
            </button>
            <!-- აქ შემდგომ დაემატება ინდივიდუალური ბლოკების ბარათები -->
          </div>
        </div>
      </section>
      <section id="registrations-section" class="exam-settings" style="display:none;">
        <div class="exam-content">
          <div class="users-filters-section">
            <div class="users-filters-header">
              <h2 class="exam-blocks-title">რეგისტრირებული პირები</h2>
              <div class="users-filters-controls">
                <input id="usersSearch" class="exam-blocks-search" type="search" placeholder="ძებნა (სახელი/გვარი/ელფოსტა/ტელეფონი/კოდი/პირადი)" />
                <select id="usersSort" class="users-sort-select">
                  <option value="date_desc">თარიღი ↓ (ნაგულისხმევი)</option>
                  <option value="date_asc">თარიღი ↑</option>
                  <option value="name_asc">სახელი/გვარი ა-ჰ</option>
                  <option value="name_desc">სახელი/გვარი ჰ-ა</option>
                </select>
              </div>
            </div>
            <div class="users-filters-checkboxes">
              <label class="users-filter-label">
                <input id="onlyAdmins" type="checkbox" />
                <span>მხოლოდ ადმინები</span>
              </label>
              <label class="users-filter-label">
                <input id="filterArchitects" type="checkbox" />
                <span>არქიტექტორები</span>
              </label>
              <label class="users-filter-label">
                <input id="filterExperts" type="checkbox" />
                <span>არქიტექტორი ექსპერტები</span>
              </label>
              <label class="users-filter-label">
                <input id="filterCertified" type="checkbox" />
                <span>სერტიფიცირებული პირები</span>
              </label>
            </div>
          </div>
          <div id="usersGrid" class="exam-blocks-grid"></div>
        </div>
      </section>
    </main>

    <div id="candidateResultsOverlay" class="results-overlay" aria-hidden="true">
      <div class="results-modal" role="dialog" aria-modal="true" aria-labelledby="candidateResultsTitle">
        <div class="results-modal-head">
          <div class="results-modal-titles">
            <h2 id="candidateResultsTitle">გამოცდის შედეგები</h2>
            <div class="results-modal-meta">
              <span class="meta-item" id="candidateResultsFullName"></span>
              <span class="meta-item" id="candidateResultsCode"></span>
              <span class="meta-item" id="candidateResultsPersonalId"></span>
            </div>
          </div>
          <div class="results-modal-actions">
            <button type="button" class="modal-close" id="candidateResultsClose" aria-label="დახურვა">×</button>
          </div>
        </div>
        <div class="results-modal-body">
          <div id="candidateResultsList" class="attempts-list" role="list"></div>
        </div>
      </div>
    </div>

    <div id="userStatementsOverlay" class="results-overlay" aria-hidden="true">
      <div class="results-modal" role="dialog" aria-modal="true" aria-labelledby="userStatementsTitle">
        <div class="results-modal-head">
          <div class="results-modal-titles">
            <h2 id="userStatementsTitle">განცხადებები</h2>
            <div class="results-modal-meta">
              <span class="meta-item" id="userStatementsMeta"></span>
            </div>
          </div>
          <div class="results-modal-actions">
            <button type="button" class="modal-close" id="userStatementsClose" aria-label="დახურვა">×</button>
          </div>
        </div>
        <div class="results-modal-body">
          <div id="userStatementsList" class="statements-list" role="list"></div>
        </div>
      </div>
    </div>

    <div id="userCertificateOverlay" class="results-overlay" aria-hidden="true">
      <div class="certificate-modal" role="dialog" aria-modal="true" aria-labelledby="userCertificateTitle">
        <div class="certificate-modal-head">
          <div class="certificate-modal-titles">
            <h2 id="userCertificateTitle">სერტიფიკატი</h2>
            <p class="certificate-modal-subtitle">სერტიფიცირებული პირის დეტალური მონაცემები</p>
          </div>
          <div class="certificate-modal-actions">
            <button type="button" class="secondary-btn certificate-action-btn certificate-action-btn--danger" id="userCertificateDelete" disabled>სერტიფიკატის წაშლა</button>
            <button type="button" class="secondary-btn certificate-action-btn" id="userCertificateDownload">PDF</button>
            <button type="button" class="modal-close" id="userCertificateClose" aria-label="დახურვა">×</button>
          </div>
        </div>
        <div class="certificate-modal-body">
          <div id="certificateCard" class="certificate-card" data-cert-tier="architect">
            <div class="certificate-card__toolbar">
              <button type="button" class="certificate-card__edit" id="certificateEditBtn">რედაქტირება</button>
            </div>
            <div class="certificate-card__decor certificate-card__decor--top"></div>
            <div class="certificate-card__decor certificate-card__decor--bottom"></div>
            <div class="certificate-card__org">საქართველოს პროფესიული სერტიფიცირების ინსტიტუტი</div>
            <div class="certificate-card__title">სერტიფიკატი</div>
            <p class="certificate-card__statement">მასზედ რომ მან წარმატებით ჩააბარა სასერტიფიკაციო გამოცდები და მიენიჭა</p>
            <div class="certificate-card__tier" data-cert-field="levelLabel">არქიტექტორი</div>
            <div class="certificate-card__status" id="certificateStatusBadge" data-cert-field="statusLabel">მოქმედი</div>
            <div class="certificate-card__code">
              <span class="certificate-card__code-label">უნიკალური კოდი</span>
              <span class="certificate-card__code-value" data-cert-field="uniqueCode">ARC-000000</span>
            </div>
            <div class="certificate-card__person">
              <span class="certificate-card__person-label">სერტიფიკატის მფლობელი</span>
              <span class="certificate-card__person-name" data-cert-field="fullName">—</span>
            </div>
            <div class="certificate-card__info-grid">
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">სახელი</span>
                <span class="certificate-card__info-value" data-cert-field="firstName">—</span>
              </div>
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">გვარი</span>
                <span class="certificate-card__info-value" data-cert-field="lastName">—</span>
              </div>
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">ტელეფონი</span>
                <span class="certificate-card__info-value" data-cert-field="phone">—</span>
              </div>
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">ელფოსტა</span>
                <span class="certificate-card__info-value" data-cert-field="email">—</span>
              </div>
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">გაცემის თარიღი</span>
                <span class="certificate-card__info-value" data-cert-field="issueDate">—</span>
              </div>
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">მოქმედების ვადა (წელი)</span>
                <span class="certificate-card__info-value" data-cert-field="validityTerm">—</span>
              </div>
              <div class="certificate-card__info-item">
                <span class="certificate-card__info-label">მოქმედების საბოლოო თარიღი</span>
                <span class="certificate-card__info-value" data-cert-field="validUntil">—</span>
              </div>
            </div>
            <div class="certificate-card__footnote">
              <p>სერტიფიკატი ძალაშია მითითებულ ვადამდე, თუ სხვა გადაწყვეტილება არ იქნა მიღებული საქართველოს პროფესიული სერტიფიცირების ინსტიტუტის მიერ.</p>
            </div>
            <div class="certificate-card__signatures">
              <div class="certificate-card__signature">
                <div class="certificate-card__signature-placeholder" id="certificateSignatureDirector"></div>
                <span class="certificate-card__signature-label">აღმასრულებელი დირექტორი</span>
                <span class="certificate-card__signature-name">ლაშა ფოფხაძე</span>
              </div>
              <div class="certificate-card__signature">
                <div class="certificate-card__signature-placeholder" id="certificateSignatureOrganizer"></div>
                <span class="certificate-card__signature-label">სასერტიფიკაციო პროცესის ორგანიზატორი</span>
                <span class="certificate-card__signature-name">არქიტექტურის დოქტორი, სამშენებლო რეგულაციების ექსპერტი, პროფესორი გიორგი ლოთიშვილი</span>
              </div>
            </div>
          </div>
          <div id="certificateEmptyState" class="certificate-empty hidden">
            <div class="certificate-empty__badge">სერტიფიკატი არ არის შექმნილი</div>
            <h3>ამ პირს ჯერ არ გააჩნია სერტიფიკატი</h3>
            <p>დააჭირე ღილაკს „სერტიფიკატის შექმნა“, შეავსე მონაცემები და სისტემა ავტომატურად შექმნის სერტიფიკატის ბარათს.</p>
            <button type="button" class="primary-btn certificate-action-btn" id="certificateEmptyCreate">სერტიფიკატის შექმნა</button>
          </div>
          <form id="certificateForm" class="certificate-form hidden" novalidate>
            <input type="hidden" id="certificateFormCode" name="uniqueCode" />
            <input type="hidden" id="certificateFormValidUntil" name="validUntil" />
            <div class="certificate-form__summary">
              <div class="certificate-form__summary-item">
                <span class="certificate-form__summary-label">სახელი, გვარი</span>
                <span class="certificate-form__summary-value" id="certificateFormName">—</span>
              </div>
              <div class="certificate-form__summary-item">
                <span class="certificate-form__summary-label">ტელეფონი</span>
                <span class="certificate-form__summary-value" id="certificateFormPhone">—</span>
              </div>
              <div class="certificate-form__summary-item">
                <span class="certificate-form__summary-label">ელფოსტა</span>
                <span class="certificate-form__summary-value" id="certificateFormEmail">—</span>
              </div>
              <div class="certificate-form__summary-item">
                <span class="certificate-form__summary-label">უნიკალური კოდი</span>
                <span class="certificate-form__summary-value" id="certificateFormCodeDisplay">—</span>
              </div>
            </div>
            <div class="certificate-form__grid">
              <label class="certificate-form__field">
                <span class="certificate-form__label">სერტიფიკატის ხარისხი</span>
                <select id="certificateFormLevel" name="level" required>
                  <option value="architect">არქიტექტორი</option>
                  <option value="expert">არქიტექტორი ექსპერტი</option>
                </select>
              </label>
              <label class="certificate-form__field">
                <span class="certificate-form__label">სტატუსი</span>
                <select id="certificateFormStatus" name="status" required>
                  <option value="active">მოქმედი</option>
                  <option value="suspended">შეჩერებული</option>
                  <option value="expired">ვადაგასული</option>
                </select>
              </label>
              <label class="certificate-form__field">
                <span class="certificate-form__label">გაცემის თარიღი</span>
                <input type="date" id="certificateFormIssueDate" name="issueDate" required />
              </label>
              <label class="certificate-form__field">
                <span class="certificate-form__label">მოქმედების ვადა (წელი)</span>
                <input type="number" min="1" max="20" step="1" id="certificateFormValidityTerm" name="validityTerm" value="5" required />
              </label>
            </div>
            <div class="certificate-form__meta">
              <div class="certificate-form__meta-label">მოქმედების საბოლოო თარიღი</div>
              <div class="certificate-form__meta-value" id="certificateFormValidUntilDisplay">—</div>
            </div>
            <div class="certificate-form__actions">
              <button type="submit" class="primary-btn certificate-action-btn" id="certificateFormSubmit">შენახვა</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="userEditOverlay" class="results-overlay" aria-hidden="true">
      <div class="results-modal" role="dialog" aria-modal="true" aria-labelledby="userEditTitle">
        <div class="results-modal-head">
          <div class="results-modal-titles">
            <h2 id="userEditTitle">მონაცემების რედაქტირება</h2>
          </div>
          <div class="results-modal-actions">
            <button type="button" class="modal-close" id="userEditClose" aria-label="დახურვა">×</button>
          </div>
        </div>
        <div class="results-modal-body">
          <form id="userEditForm" class="user-edit-form">
            <div class="user-edit-grid">
              <label class="user-edit-field">
                <span class="user-edit-label">სახელი</span>
                <input id="userEditFirstName" type="text" name="firstName" autocomplete="given-name" required />
              </label>
              <label class="user-edit-field">
                <span class="user-edit-label">გვარი</span>
                <input id="userEditLastName" type="text" name="lastName" autocomplete="family-name" required />
              </label>
              <label class="user-edit-field">
                <span class="user-edit-label">პირადი ნომერი</span>
                <input id="userEditPersonalId" type="text" name="personalId" inputmode="numeric" pattern="\d*" maxlength="11" required />
              </label>
              <label class="user-edit-field">
                <span class="user-edit-label">ტელეფონი</span>
                <input id="userEditPhone" type="tel" name="phone" autocomplete="tel" required />
              </label>
              <label class="user-edit-field">
                <span class="user-edit-label">ელფოსტა</span>
                <input id="userEditEmail" type="email" name="email" autocomplete="email" required />
              </label>
              <label class="user-edit-field">
                <span class="user-edit-label">უნიკალური კოდი</span>
                <input id="userEditCode" type="text" name="code" autocomplete="off" readonly />
              </label>
            </div>
            <div class="user-edit-actions">
              <button type="button" class="secondary-btn" id="userEditCancel">გაუქმება</button>
              <button type="submit" class="primary-btn" id="userEditSave">შენახვა</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="resultDetailOverlay" class="results-overlay" aria-hidden="true">
      <div class="results-modal results-modal--wide" role="dialog" aria-modal="true" aria-labelledby="resultDetailTitle">
        <div class="results-modal-head">
          <div class="results-modal-titles">
            <h2 id="resultDetailTitle">შედეგის დეტალები</h2>
            <div class="results-modal-meta">
              <span class="meta-item" id="resultDetailExamTitle"></span>
              <span class="meta-item" id="resultDetailStatus"></span>
            </div>
          </div>
          <div class="results-modal-actions">
            <button type="button" class="result-media-trigger disabled" id="resultDetailMedia" disabled>
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M17 10.5V7a2 2 0 0 0-2-2H5A2 2 0 0 0 3 7v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3.5l4 3v-9l-4 3Z" fill="currentColor"/>
              </svg>
              ვიდეოთვალი
            </button>
            <button type="button" class="result-media-trigger disabled" id="resultDetailScreenMedia" disabled>
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 5h16a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1h-6l1.5 2h-6L9 17H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1zm0 2v8h16V7H4z" fill="currentColor"/>
              </svg>
              სკრინი
            </button>
            <button type="button" class="primary-btn" id="resultDetailDownload">შედეგების ჩამოტვირთვა</button>
            <button type="button" class="modal-close" id="resultDetailClose" aria-label="დახურვა">×</button>
          </div>
        </div>
        <div class="results-modal-body results-detail-body">
          <section class="result-section">
            <h3>ძირითადი ინფორმაცია</h3>
            <div class="result-info-grid">
              <div><span class="label">კანდიდატი</span><span id="resultDetailCandidate"></span></div>
              <div><span class="label">პირადი №</span><span id="resultDetailPersonalId"></span></div>
              <div><span class="label">კოდი</span><span id="resultDetailCode"></span></div>
              <div><span class="label">დაწყება</span><span id="resultDetailStartedAt"></span></div>
              <div><span class="label">დასრულება</span><span id="resultDetailFinishedAt"></span></div>
              <div><span class="label">ხანგრძლივობა</span><span id="resultDetailDuration"></span></div>
              <div><span class="label">საერთო ქულა</span><span id="resultDetailScore"></span></div>
            </div>
          </section>

          <section class="result-section">
            <h3>ბლოკების შედეგები</h3>
            <div id="resultBlockStats" class="block-stats-grid"></div>
          </section>

          <section class="result-section" id="resultMediaSection" hidden>
            <h3>ვიდეო ჩანაწერი</h3>
            <div class="result-media">
              <div class="result-media-player">
                <video id="resultMediaPlayer" controls preload="metadata"></video>
              </div>
              <div class="result-media-actions">
                <a href="#" class="secondary-btn result-media-download" id="resultMediaDownload" aria-disabled="true" role="button">ჩანაწერის ჩამოტვირთვა</a>
                <span class="result-media-info" id="resultMediaInfo"></span>
              </div>
            </div>
          </section>

          <section class="result-section">
            <div class="section-head">
              <h3>კითხვების დეტალები</h3>
              <div class="section-head-meta" id="resultDetailSummary"></div>
            </div>
            <div id="resultQuestionList" class="result-question-list"></div>
          </section>

        </div>
      </div>
    </div>

    <footer>
      <div class="footer-bottom">
        <p>2025 წ. ვებგვერდი ეკუთვნის "საქართველოს პროფესიული სერტიფიცირების ინსტიტუტს" ყველა უფლება დაცულია</p>
      </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-5v7HimoMuquMNFcQJUO2c+hJ1ytY1/6V2vNhbbX6YsJhBKt3vnDnN/SUXOcDSBx/OVCkXbkqVKgf/mBlC9F4oA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="../scripts/admin.js?v=4" defer></script>
  </body>
</html>
